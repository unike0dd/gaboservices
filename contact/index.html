<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact | Gabriel Services</title>
    <link rel="stylesheet" href="../styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container nav-wrap">
        <a class="brand" href="../">Gabriel Services</a>
        <nav>
          <ul class="nav-links">
            <li><a href="../">Home</a></li>
            <li><a href="../services">Services</a></li>
            <li><a href="../about">About</a></li>
            <li><a href="../pricing">Pricing</a></li>
            <li><a href="../contact">Contact</a></li>
          </ul>
        </nav>
      </div>
    </header>
    <main class="container section">
      <h1>Contact</h1>
      <p>Reach our team for support, onboarding, or partnership requests.</p>
      <form class="contact-form" id="contactForm">
        <label><span>Name</span><input required name="name" /></label>
        <label><span>Email</span><input required type="email" name="email" /></label>
        <label>
          <span>Your Contact Number</span>
          <div class="contact-number-row">
            <select required name="contact_country_code" aria-label="Country code">
              <option value="">Select country code</option>
              <option value="+1">United States (+1)</option>
              <option value="+52">Mexico (+52)</option>
              <option value="+34">Spain (+34)</option>
              <option value="+44">United Kingdom (+44)</option>
              <option value="+57">Colombia (+57)</option>
            </select>
            <input required type="tel" name="contact_number" inputmode="tel" autocomplete="tel-national" placeholder="555 123 4567" />
          </div>
        </label>
        <label><span>Most convenient time to contact you</span><input required type="datetime-local" name="contact_time" /></label>
        <label><span>Message</span><textarea required name="message" rows="4"></textarea></label>
        <button class="btn primary" type="submit">Send</button>
        <p id="formStatus" role="status" aria-live="polite"></p>
      </form>
    </main>
    <script>
      const form = document.getElementById('contactForm');
      const countrySelect = form.querySelector('select[name="contact_country_code"]');

      async function populateCountryCodes() {
        const fallback = [
          { name: 'United States', code: '+1' },
          { name: 'Mexico', code: '+52' },
          { name: 'Spain', code: '+34' },
          { name: 'United Kingdom', code: '+44' },
          { name: 'Colombia', code: '+57' }
        ];

        const fill = (items) => {
          countrySelect.innerHTML = ['<option value="">Select country code</option>']
            .concat(items.map((item) => `<option value="${item.code}">${item.name} (${item.code})</option>`))
            .join('');
        };

        try {
          const response = await fetch('https://restcountries.com/v3.1/all?fields=name,idd');
          if (!response.ok) throw new Error('country source unavailable');
          const countries = await response.json();
          const entries = [];

          countries.forEach((country) => {
            const name = country?.name?.common;
            const root = country?.idd?.root;
            const suffixes = country?.idd?.suffixes || [];
            if (!name || !root) return;
            suffixes.forEach((suffix) => {
              entries.push({ name, code: `${root}${suffix || ''}` });
            });
          });

          const unique = [];
          const seen = new Set();
          entries
            .sort((a, b) => a.name.localeCompare(b.name) || a.code.localeCompare(b.code))
            .forEach((entry) => {
              const key = `${entry.name}-${entry.code}`;
              if (seen.has(key)) return;
              seen.add(key);
              unique.push(entry);
            });

          fill(unique.length ? unique : fallback);
        } catch (error) {
          fill(fallback);
        }
      }

      populateCountryCodes();

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        form.reset();
        document.getElementById('formStatus').textContent = 'Message captured. We will contact you shortly.';
      });
    </script>
  </body>
</html>
